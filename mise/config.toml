# Mise configuration for dotfiles repository
# Documentation: https://mise.jdx.dev/configuration.html

[settings]
# Automatically install missing tools when entering directory
auto_install = true

# Use verbose output for better debugging
verbose = false

# Experimental features
experimental = true

[env]
# Dotfiles directory
DOTFILES = "{{config_root}}"

# XDG Base Directory Specification
XDG_CONFIG_HOME = "~/.config"
XDG_DATA_HOME = "~/.local/share"
XDG_CACHE_HOME = "~/.cache"

[tools]
# Core system tools
"brew:stow" = "latest"           # Dotfiles symlink manager
"brew:git" = "latest"            # Version control
"brew:git-lfs" = "latest"        # Git Large File Storage

# Mise itself (ensures latest version)
"brew:mise" = "latest"

# Modern shell utilities
"brew:eza" = "latest"                    # Modern replacement for 'ls'
"brew:bat" = "latest"                    # Modern replacement for 'cat' with syntax highlighting
"brew:fzf" = "latest"                    # Fuzzy finder
"brew:zoxide" = "latest"                 # Smarter 'cd' command
"brew:ripgrep" = "latest"                # Fast grep alternative
"brew:fd" = "latest"                     # Fast find alternative
"brew:zsh-autosuggestions" = "latest"    # Zsh autosuggestions
"brew:zsh-syntax-highlighting" = "latest" # Zsh syntax highlighting
"brew:atuin" = "latest"                  # Shell history management

# Shell prompt
"brew:starship" = "latest"               # Cross-shell prompt

# Editors
"brew:neovim" = "latest"         # Modern Vim-based editor
"brew:emacs" = "latest"          # Extensible text editor

# Include tool-specific configurations
[task_config]
includes = [
    "~/.config/mise/tmux.toml",
    "~/.config/mise/aerospace.toml",
    "~/.config/mise/wezterm.toml"
]

[tasks.install]
description = "Install all tools and set up dotfiles"
run = [
    "mise install",
    "mkdir -p $HOME/.config",
    "echo 'All tools installed. Run mise run setup to configure dotfiles.'",
]

[tasks.setup]
description = "Set up dotfiles using stow"
depends = ["install"]
run = [
    "stow --adopt -t ~/.config -v .",
    "echo 'Dotfiles symlinked to ~/.config'",
]

[tasks.tangle]
description = "Tangle all Org mode configuration files"
run = '''
emacs --batch --eval "(progn \
  (require 'org) \
  (dolist (file '(\"tmux/README.org\" \
                  \"wezterm/README.org\" \
                  \"aerospace/README.org\" \
                  \"starship/README.org\" \
                  \"git/README.org\" \
                  \"nvim/README.org\" \
                  \"emacs/config.org\" \
                  \"mise/mise.org\" \
                  \"mise/mise.tmux.org\" \
                  \"mise/mise.aerospace.org\" \
                  \"mise/mise.wezterm.org\")) \
    (when (file-exists-p file) \
      (message \"Tangling %s...\" file) \
      (with-current-buffer (find-file-noselect file) \
        (org-babel-tangle) \
        (kill-buffer)))))"
'''

[tasks.update]
description = "Update all tools to latest versions"
run = [
    "mise upgrade",
    "brew upgrade",
    "echo 'All tools updated.'",
]

[tasks.verify]
description = "Verify stow configuration (dry run)"
run = "stow --adopt -t ~/.config -nv ."

[tasks.restow]
description = "Re-stow all configurations"
run = "stow -Rt ~/.config ."

[tasks.clean]
description = "Remove all symlinks created by stow"
run = "stow -Dt ~/.config ."

[tasks.doctor]
description = "Check mise and tool installation status"
run = [
    "mise doctor",
    "mise list",
]
